option_settings:
  aws:elasticbeanstalk:container:php:phpini:
    document_root: /public
    memory_limit: 256M
    zlib.output_compression: "Off"
    allow_url_fopen: "On"
    display_errors: "Off"
    max_execution_time: 60

commands:
  01_install_composer:
    command: "curl -sS https://getcomposer.org/installer | php"
    cwd: /usr/local/bin
    test: "[ ! -f /usr/local/bin/composer ]"

  02_install_dependencies:
    command: "php /usr/local/bin/composer.phar install --no-dev --optimize-autoloader"
    cwd: /var/app/current

container_commands:
  01_storage_permissions:
    command: |
      chmod -R 775 storage
      chmod -R 775 bootstrap/cache
    leader_only: true

  02_run_migrations:
    command: "php artisan migrate --force"
    leader_only: true 